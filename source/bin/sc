#!/usr/bin/env python3
"""CLI to set up shellcuts for the first time.

This script gives users a CLI menu to help them finish setting up shellcuts.
It contains three commands:
    -Automatically modify bashrc to complete installation
    -Manually modify bashrc
    -Display contents of the script

Arguments:
    None.

Returns:
    None.

Legal:
    Author: Tiger Sachse
    License: GPLv3
    Version: 1.1.2
    Initial Release: 12/31/2017
    Current Release: 01/02/2018
"""

import os
import sys
import subprocess

# Location of bashrc and shellcuts source file.
F_BASHRC = os.path.expanduser('~/.bashrc')
F_SOURCE = '/usr/share/shellcuts/shellcuts.sh'

# List of lines added to bashrc.
NEW_BASHRC_LINES = [
    '# checks if the shellcuts source file exists and includes it', 
    'if [ -f {0} ]; then'.format(F_SOURCE),
    '    . {0}'.format(F_SOURCE),
    'fi']

INIT_PROMPT = [
    'Thank you for downloading Shellcuts!\n',
    'If you\'ve already initialized Shellcuts and are still getting this',
    'menu then you must restart your terminal for changes to take effect.\n',
    'Enter the number corresponding to the action you wish to perform:',
    '0) Automatically modify bashrc to complete installation',
    '1) Manually modify bashrc',
    '2) Display contents of this script']
    
def load_bashrc():
    """Read bashrc and returns list of lines."""
    try:
        with open(F_BASHRC, 'r') as f:
            return f.readlines()
    except FileNotFoundError:
        return []

def write_bashrc(lines):
    """Write list of lines to bashrc."""
    with open(F_BASHRC, 'w') as f:
        f.writelines(lines)

# Start of main program.
subprocess.run('clear')

# Print each line in INIT_PROMPT
[print(line) for line in INIT_PROMPT]
command = input("> ")

if command == '0':
    """Modify bashrc file and source from modified file."""
    print("Adding to bashrc...")
    bashrc = load_bashrc()
    bashrc.append('\n')
    bashrc.extend([line+'\n' for line in NEW_BASHRC_LINES])
    write_bashrc(bashrc)
    print("Done! Restart your terminal for changes to take effect.")
    
elif command == '1':
    """Print necessary changes to screen for bashrc file."""
    print("Add these three lines to your .bashrc:\n")
    for line in NEW_BASHRC_LINES[1:]:
        print(line)
    print("\nRestart your terminal for changes to take effect.")

elif command == '2':
    """Cat this script to screen."""
    location = os.path.abspath(sys.argv[0])
    print("LOCATION: " + location)
    print("CONTENTS:")
    subprocess.run(['cat', location])
